

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Plotting derivatives of simple sine function &mdash; py-earth 0.1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  

  
    <link rel="top" title="py-earth 0.1.0 documentation" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> py-earth</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Plotting derivatives of simple sine function</a></li>
</ul>
</div>
          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">py-earth</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Plotting derivatives of simple sine function</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/auto_examples/plot_derivatives.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="plotting-derivatives-of-simple-sine-function">
<span id="example-plot-derivatives-py"></span><h1>Plotting derivatives of simple sine function<a class="headerlink" href="#plotting-derivatives-of-simple-sine-function" title="Permalink to this headline">Â¶</a></h1>
<p>A simple example plotting a fit of the sine function and
the derivatives computed by Earth.</p>
<img alt="../_images/plot_derivatives_001.png" class="align-center" src="../_images/plot_derivatives_001.png" />
<p><strong>Script output</strong>:</p>
<div class="sphx-glr-script-out highlight-python"><div class="highlight"><pre>Forward Pass
------------------------------------------------------------------
iter  parent  var  knot  mse        terms  gcv     rsq    grsq
------------------------------------------------------------------
0     -       -    -     47.918854  1      47.928  0.000  -0.000
1     0       6    7511  44.378017  3      44.458  0.074  0.072
2     1       6    4611  35.601672  5      35.723  0.257  0.255
3     0       6    8718  22.245946  7      22.358  0.536  0.534
4     0       6    2811  12.177769  9      12.259  0.746  0.744
5     0       6    5618  3.791498   11     3.823   0.921  0.920
6     7       6    1411  1.536961   13     1.552   0.968  0.968
7     5       6    6211  1.121519   15     1.134   0.977  0.976
8     0       6    4118  0.689255   17     0.698   0.986  0.985
9     0       6    9225  0.344292   19     0.349   0.993  0.993
10    9       6    2411  0.250672   21     0.255   0.995  0.995
11    17      6    1011  0.208758   23     0.213   0.996  0.996
------------------------------------------------------------------
Stopping Condition 2: Improvement below threshold

Pruning Pass
-----------------------------------------------
iter  bf  terms  mse    gcv     rsq    grsq
-----------------------------------------------
0     -   23     0.21   0.213   0.996  0.996
1     17  22     0.21   0.212   0.996  0.996
2     2   21     0.21   0.212   0.996  0.996
3     9   20     0.21   0.212   0.996  0.996
4     5   19     0.21   0.212   0.996  0.996
5     7   18     0.21   0.212   0.996  0.996
6     6   17     0.21   0.212   0.996  0.996
7     12  16     0.21   0.217   0.996  0.995
8     13  15     0.23   0.235   0.995  0.995
9     20  14     0.28   0.279   0.994  0.994
10    11  13     0.44   0.441   0.991  0.991
11    21  12     0.60   0.606   0.987  0.987
12    19  11     1.11   1.116   0.977  0.977
13    14  10     1.99   2.002   0.959  0.958
14    4   9      2.53   2.546   0.947  0.947
15    3   8      3.14   3.156   0.935  0.934
16    10  7      5.05   5.079   0.895  0.894
17    8   6      11.08  11.131  0.769  0.768
18    15  5      27.53  27.622  0.426  0.424
19    18  4      36.76  36.855  0.233  0.231
20    1   3      45.84  45.923  0.043  0.042
21    22  2      46.04  46.089  0.039  0.038
22    16  1      47.92  47.928  0.000  -0.000
-----------------------------------------------
Selected iteration: 6

Earth Model
--------------------------------------------------------------------------------------------------
Basis Function                                                               Pruned  Coefficient
--------------------------------------------------------------------------------------------------
(Intercept)                                                                  No      447.285
C(x6|s=+1,-6.26875,-5.08316,-3.80451)                                        No      -40.5868
C(x6|s=-1,-6.26875,-5.08316,-3.80451)                                        Yes     None
C(x6|s=+1,-0.315974,0.653401,1.17646)*C(x6|s=+1,-6.26875,-5.08316,-3.80451)  No      -4.17297
C(x6|s=-1,-0.315974,0.653401,1.17646)*C(x6|s=+1,-6.26875,-5.08316,-3.80451)  No      3.18397
C(x6|s=+1,-7.95761,-7.45435,-6.26875)                                        Yes     None
C(x6|s=-1,-7.95761,-7.45435,-6.26875)                                        Yes     None
C(x6|s=+1,3.04353,4.38755,4.81086)                                           Yes     None
C(x6|s=-1,3.04353,4.38755,4.81086)                                           No      8.15993
C(x6|s=+1,-1.90561,-1.28535,-0.315974)                                       Yes     None
C(x6|s=-1,-1.90561,-1.28535,-0.315974)                                       No      12.9332
C(x6|s=+1,6.23693,7.23971,7.61111)*C(x6|s=+1,3.04353,4.38755,4.81086)        No      -3.19345
C(x6|s=-1,6.23693,7.23971,7.61111)*C(x6|s=+1,3.04353,4.38755,4.81086)        No      1.39297
C(x6|s=+1,-3.80451,-2.52586,-1.90561)*C(x6|s=+1,-7.95761,-7.45435,-6.26875)  No      0.806822
C(x6|s=-1,-3.80451,-2.52586,-1.90561)*C(x6|s=+1,-7.95761,-7.45435,-6.26875)  No      0.679964
C(x6|s=+1,1.17646,1.69952,3.04353)                                           No      51.9728
C(x6|s=-1,1.17646,1.69952,3.04353)                                           No      -64.3756
C(x6|s=+1,-9.23024,-8.46088,-7.95761)                                        Yes     None
C(x6|s=-1,-9.23024,-8.46088,-7.95761)                                        No      52.7867
C(x6|s=+1,4.81086,5.23416,6.23693)*C(x6|s=+1,-1.90561,-1.28535,-0.315974)    No      1.72991
C(x6|s=-1,4.81086,5.23416,6.23693)*C(x6|s=+1,-1.90561,-1.28535,-0.315974)    No      -0.240492
C(x6|s=+1,7.61111,7.98251,8.99069)*C(x6|s=+1,-9.23024,-8.46088,-7.95761)     No      2.56522
C(x6|s=-1,7.61111,7.98251,8.99069)*C(x6|s=+1,-9.23024,-8.46088,-7.95761)     No      -2.83545
--------------------------------------------------------------------------------------------------
MSE: 0.0842, GCV: 0.0853, RSQ: 0.9982, GRSQ: 0.9982
</pre></div>
</div>
<p><strong>Python source code:</strong> <a class="reference download internal" href="../_downloads/plot_derivatives.py"><code class="xref download docutils literal"><span class="pre">plot_derivatives.py</span></code></a></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">pyearth</span> <span class="kn">import</span> <span class="n">Earth</span>

<span class="c"># Create some fake data</span>
<span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">X</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">-</span> <span class="mi">10</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">])</span>  <span class="o">+</span> \
    <span class="mf">0.25</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>

<span class="c"># Compute the known true derivative with respect to the predictive variable</span>
<span class="n">y_prime</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">])</span>

<span class="c"># Fit an Earth model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Earth</span><span class="p">(</span><span class="n">max_degree</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">minspan_alpha</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c"># Print the model</span>
<span class="k">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">trace</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>

<span class="c"># Get the predicted values and derivatives</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">y_prime_hat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_deriv</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="s">&#39;x6&#39;</span><span class="p">)</span>

<span class="c"># Plot true and predicted function values and derivatives for the predictive variable</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;r.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">y_hat</span><span class="p">,</span> <span class="s">&#39;b.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;function&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">y_prime</span><span class="p">,</span> <span class="s">&#39;r.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">y_prime_hat</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;b.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;derivative&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Total running time of the example:</strong>  19.70 seconds
( 0 minutes  19.70 seconds)</p>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013, Jason Rudy.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>